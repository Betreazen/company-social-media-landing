# Docker Compose — Endorphina Social Media Landing
# Usage:
#   Initial launch (HTTP only):  docker compose up -d
#   After SSL cert issuance:     see README for switching to HTTPS config

services:
  # ---------- Nginx (static site + reverse proxy) ----------
  nginx:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: endorphina-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      # Mount Nginx config (swap default.conf → default-ssl.conf after SSL setup)
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
      # Shared volumes for Certbot
      - ./certbot/www:/var/www/certbot:ro
      - ./letsencrypt:/etc/letsencrypt:ro
    depends_on: []

  # ---------- Certbot (SSL certificate management) ----------
  certbot:
    image: certbot/certbot
    container_name: endorphina-certbot
    volumes:
      - ./certbot/www:/var/www/certbot
      - ./letsencrypt:/etc/letsencrypt
    # Auto-renewal: check twice daily, renew if needed
    entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew --webroot -w /var/www/certbot --quiet; sleep 12h & wait $${!}; done'"
